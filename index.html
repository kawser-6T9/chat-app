<!DOCTYPE html><html lang="bn">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FD Group Chat</title>
  <link rel="stylesheet" href="styles.css" />
  <style>
    body { font-family: sans-serif; margin: 0; background: #f2f2f2; }
    header { background: #2f80ed; padding: 16px; color: white; text-align: center; font-weight: bold; position: relative; }
    #callBtn { position: absolute; right: 16px; top: 50%; transform: translateY(-50%); background: transparent; border: none; font-size: 24px; cursor: pointer; color: white; }
    #chatBox { height: 75vh; overflow-y: auto; padding: 10px; display: flex; flex-direction: column; gap: 10px; }
    .msg { max-width: 80%; padding: 10px 15px; border-radius: 15px; font-size: 15px; }
    .msg.me { background: #d2f8d2; align-self: flex-end; }
    .msg.other { background: white; align-self: flex-start; }
    .name { font-weight: bold; font-size: 13px; color: #555; }
    .reply-box { background: #eee; font-size: 12px; padding: 5px; margin-bottom: 3px; border-left: 3px solid #2f80ed; }
    .input-area { display: flex; padding: 10px; background: white; border-top: 1px solid #ddd; }
    input[type="text"] { flex: 1; padding: 10px; border-radius: 20px; border: 1px solid #ccc; }
    button { margin-left: 10px; border: none; background: #2f80ed; color: white; padding: 0 20px; border-radius: 20px; font-size: 16px; }
    .actions { font-size: 11px; color: #999; margin-top: 4px; cursor: pointer; }
    #replyPreview { background: #dbeaff; padding: 5px; font-size: 13px; margin: 5px; border-left: 3px solid #2f80ed; display: none; }
  </style>
</head>
<body><header>
  FD Group Chat
  <button id="callBtn" title="Call" onclick="location.href='call.html'">ðŸ“ž</button>
</header>
<div id="chatBox"></div>
<div id="replyPreview"></div>
<div class="input-area">
  <input type="file" id="fileInput" hidden />
  <input type="text" id="messageInput" placeholder="à¦®à§‡à¦¸à§‡à¦œ à¦²à¦¿à¦–à§‹..." />
  <button onclick="sendMessage()">Send</button>
</div><audio id="notifSound" src="assets/notification.mp3"></audio>

<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script><script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script><script>
  const firebaseConfig = {
    apiKey: "AIzaSyAemPZqI87bw7S3v4Wn0VOpHzmCCVP1MqU",
    authDomain: "chat-app-62f68.firebaseapp.com",
    projectId: "chat-app-62f68",
    storageBucket: "chat-app-62f68.firebasestorage.app",
    messagingSenderId: "887562025936",
    appId: "1:887562025936:web:4846398f3764deda86d7d5"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
  const chatBox = document.getElementById("chatBox");
  const messageInput = document.getElementById("messageInput");
  const notifSound = document.getElementById("notifSound");
  const replyPreview = document.getElementById("replyPreview");

  let userName = prompt("à¦¤à§‹à¦®à¦¾à¦° à¦¨à¦¾à¦® à¦²à¦¿à¦–à§‹:");
  let replyingTo = null;

  function sendMessage() {
    const text = messageInput.value.trim();
    if (!text) return;
    db.collection("messages").add({
      sender: userName,
      text,
      timestamp: firebase.firestore.FieldValue.serverTimestamp(),
      replyTo: replyingTo || null
    });
    messageInput.value = "";
    replyPreview.style.display = "none";
    replyingTo = null;
  }

  function deleteForMe(id) {
    document.getElementById(id).style.display = "none";
  }

  function unsendMessage(docId) {
    db.collection("messages").doc(docId).delete();
  }

  function replyToMessage(id, name, text) {
    replyPreview.innerText = `Replying to ${name}: ${text}`;
    replyPreview.style.display = "block";
    replyingTo = id;
  }

  db.collection("messages").orderBy("timestamp")
    .onSnapshot(snapshot => {
      chatBox.innerHTML = "";
      snapshot.forEach(doc => {
        const msg = doc.data();
        const type = msg.sender === userName ? "me" : "other";
        const div = document.createElement("div");
        div.className = `msg ${type}`;
        div.id = doc.id;
        if (msg.replyTo) {
          div.innerHTML += `<div class='reply-box'>${msg.replyTo}</div>`;
        }
        div.innerHTML += `<div class='name'>${msg.sender}</div><div>${msg.text}</div>`;
        div.innerHTML += `<div class='actions'>
            <span onclick="replyToMessage('${doc.id}', '${msg.sender}', '${msg.text}')">Reply</span> |
            <span onclick="deleteForMe('${doc.id}')">Delete for me</span>
            ${msg.sender === userName ? `| <span onclick="unsendMessage('${doc.id}')">Unsend</span>` : ""}
          </div>`;
        chatBox.appendChild(div);
      });
      chatBox.scrollTop = chatBox.scrollHeight;
      notifSound.play();
    });
</script></body>
</html>
